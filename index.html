<!DOCTYPE html>

<html lang="pt-BR">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>SolicitaÃ§Ã£o de Folga - DERSO</title>



    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">



    <style>

        /* 1. PALETA DE CORES INSTITUCIONAL */

        :root {

            --azul-marinho: #0C3667; /* Azul Escuro / Azul Noturno (Forte) */

            --dourado-amarelo: #FFD700; /* Amarelo Forte para destaque/progresso */

            --azul-claro-hover: #1a5ca7; /* Para hover/botÃµes */

            --erro: #b00020; /* Vermelho mais profundo para alertas */

            --sucesso: #388e3c; /* Verde mais escuro */

            --cinza-fundo: #f4f7f9; /* Fundo mais suave */

            --cinza-texto: #333333; /* Texto escuro com alto contraste */

            --borda-campo: #aaa;

        }



        /* 2. TIPOGRAFIA E FUNDO */

        body {

            background-color: var(--cinza-fundo);

            font-family: 'Roboto', Arial, sans-serif;

            color: var(--cinza-texto);

            margin: 0;

            padding: 0;

            display: flex;

            justify-content: center;

            align-items: center;

            min-height: 100vh;

        }



        .container {

            width: 95%;

            max-width: 500px;

            background-color: #ffffff; /* Fundo branco puro para efeito "papel" */

            border-radius: 8px;

            padding: 30px;

            /* Sombra mais forte e borda sutil */

            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);

            border: 1px solid #ccc;

            box-sizing: border-box;

            display: flex;

            flex-direction: column;

            position: relative;

        }



        /* Barra de progresso (Agora DOURADA e sutil) */

        #progressBarContainer {

            position: absolute;

            top: 0;

            left: 0;

            width: 100%;

            height: 4px;

            background-color: #e0e0e0;

            border-radius: 8px 8px 0 0;

            overflow: hidden;

        }



        #progressBar {

            width: 0%;

            height: 100%;

            background-color: var(--dourado-amarelo); /* Dourado para destaque */

            transition: width 0.4s ease;

        }



        /* Logos */

        .logos {

            display: flex;

            justify-content: center;

            align-items: center;

            gap: 15px;

            margin-bottom: 15px;

        }



        .logos img {

            height: 70px;

            object-fit: contain;

        }



        /* 3. ESTILO DO TÃTULO COM AUTORIDADE */

        h2 {

            font-family: 'Merriweather', serif;

            text-align: center;

            color: var(--azul-marinho);

            font-size: 28px;

            font-weight: 700;

            margin-bottom: 10px;

            line-height: 1.2;

            letter-spacing: -0.5px;

            /* Linha divisÃ³ria de destaque DOURADA */

            border-bottom: 2px solid var(--dourado-amarelo);

            padding-bottom: 5px;

        }



        .subtitle {

            text-align: center;

            color: var(--cinza-texto);

            font-size: 16px;

            margin-bottom: 25px;

        }



        .form-group, fieldset {

            margin-bottom: 20px;

            width: 100%;

            border: none;

            padding: 0;

        }



        label, legend {

            display: block;

            margin-bottom: 8px;

            color: var(--cinza-texto);

            font-weight: 500;

            font-size: 15px;

        }



        /* 4. ESTILO DOS CAMPOS (Mais formais) */

        .form-group input:not([type="radio"]),

        .form-group select {

            width: 100%;

            padding: 12px 15px;

            font-size: 15px;

            border: 1px solid var(--borda-campo);

            border-radius: 4px; /* Menos arredondado */

            box-sizing: border-box;

            transition: border-color 0.3s ease, box-shadow 0.3s ease;

        }



        .form-group input:not([type="radio"]):focus,

        .form-group select:focus {

            border-color: var(--azul-claro-hover);

            outline: none;

            /* Foco mais discreto */

            box-shadow: 0 0 0 2px rgba(12, 54, 103, 0.2);

        }



        input[readonly] {

            background-color: #e9ecef;

            cursor: not-allowed;

        }



        /* Estilo para os botÃµes de alternÃ¢ncia (Toggle Buttons) */

        .radio-group-buttons {

            display: flex;

            flex-wrap: wrap;

            gap: 8px; /* Menor gap */

            margin-top: 10px;

        }



        .radio-group-buttons input[type="radio"] {

            display: none;

        }



        .radio-group-buttons label {

            padding: 8px 10px; /* Padding menor */

            border: 1px solid #ccc;

            border-radius: 4px;

            cursor: pointer;

            font-size: 13px; /* Fonte menor */

            transition: background-color 0.2s, border-color 0.2s, color 0.2s;

            user-select: none;

            text-transform: uppercase;

            font-weight: 500;

        }



        .radio-group-buttons input[type="radio"]:checked + label {

            /* Cor de SeleÃ§Ã£o: Azul Marinho com texto DOURADO */

            background-color: var(--azul-marinho);

            color: var(--dourado-amarelo);

            border-color: var(--azul-marinho);

            font-weight: 700;

            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);

        }



        .radio-group-buttons label:hover {

            background-color: #e0e0e0;

            border-color: var(--azul-claro-hover);

        }



        /* Feedback visual para campos */

        .form-group input.is-valid {

            border-color: var(--sucesso) !important;

            box-shadow: 0 0 0 3px rgba(56, 142, 60, 0.2) !important;

        }



        .form-group input.is-invalid {

            border-color: var(--erro) !important;

            box-shadow: 0 0 0 3px rgba(176, 0, 32, 0.2) !important;

        }



        /* 5. ESTILO DO BOTÃƒO DE AÃ‡ÃƒO */

        .button {

            background-color: var(--azul-claro-hover);

            color: #fff;

            border: none;

            cursor: pointer;

            padding: 14px 20px;

            font-size: 16px;

            font-weight: 700;

            border-radius: 4px;

            transition: background-color 0.3s ease, transform 0.2s ease;

            display: block;

            width: 100%;

            box-sizing: border-box;

            text-transform: uppercase;

        }



        .button:hover {

            background-color: var(--azul-marinho); /* Azul Marinho no hover */

            transform: translateY(-1px);

        }



        .button:active {

            transform: translateY(0);

        }



        /* 6. ESTILO DAS MENSAGENS DE ERRO/STATUS (Mais proeminentes) */

        .error {

            color: var(--erro);

            margin-top: 5px;

            font-size: 13px;

            font-weight: 600; /* Mais negrito */

            padding-left: 5px;

        }



        .info-message {

            text-align: center;

            border-radius: 4px;

            font-size: 15px;

            font-weight: 600;

            line-height: 1.4;

            display: none;

            margin-bottom: 25px;

            padding: 12px 15px;

            border-left: 5px solid; /* Adiciona barra lateral de destaque */

        }



        .info-message.success {

            background-color: #e8f5e9; /* Fundo verde claro */

            color: var(--sucesso);

            border-left-color: var(--sucesso);

        }



        .info-message.error {

            background-color: #fce4ec; /* Fundo vermelho claro */

            color: var(--erro);

            border-left-color: var(--erro);

        }



        .footer {

            text-align: center;

            margin-top: 25px;

            font-size: 12px;

            color: #777;

        }



        /* 7. LOADING OVERLAY (para submissÃ£o) */

        #loadingOverlay {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(255, 255, 255, 0.9); /* Quase opaco */

            display: none;

            justify-content: center;

            align-items: center;

            z-index: 1000;

            font-size: 18px;

            color: var(--azul-marinho);

            flex-direction: column;

            text-align: center;

        }



        .spinner {

            border: 4px solid rgba(12, 54, 103, 0.2);

            border-top: 4px solid var(--azul-claro-hover); /* Cor de destaque no spinner */

            border-radius: 50%;

            width: 30px;

            height: 30px;

            animation: spin 1s linear infinite;

            margin-top: 15px;

        }

        @keyframes spin {

            0% { transform: rotate(0deg); }

            100% { transform: rotate(360deg); }

        }



        /* Media Queries */

        @media (max-width: 576px) {

            .container { padding: 20px; }

            h2 { font-size: 24px; }

            .subtitle { font-size: 14px; }

            .form-group input:not([type="radio"]), .form-group select { font-size: 14px; }

            .button { font-size: 15px; padding: 12px 15px; }

            .radio-group-buttons { justify-content: flex-start; } /* Deixa as opÃ§Ãµes Ã  esquerda no mÃ³vel */

            .logos img { height: 50px; }

        }



    </style>

</head>

<body>

    <div id="loadingOverlay">

        <p>Enviando solicitaÃ§Ã£o. Aguarde...</p>

        <div class="spinner"></div>

    </div>



    <div class="container" id="formulario">

        <div id="progressBarContainer"><div id="progressBar"></div></div>

        

        <div class="logos">

            <img src="https://rondonia.ro.gov.br/wp-content/uploads/2024/09/Brasao-PMRO-370x523.png" alt="PMRO">

            <img src="https://museu.pm.ro.gov.br/wp-content/uploads/2024/05/1-bpm-3.png" alt="1Âº BPM">

        </div>



        <h2>DERSO 1Âº BPM</h2>

        <p class="subtitle">FormulÃ¡rio de SolicitaÃ§Ã£o de DiÃ¡ria Especial de ReforÃ§o do ServiÃ§o Operacional - DERSO </p>



        <div id="prazoMessage" class="info-message success" style="margin-bottom: 25px;"></div>



        <div id="initialLoading" style="text-align: center; padding: 50px; color: var(--azul-marinho);">

            <p>Carregando dados do sistema...</p>

            <div class="spinner"></div>

        </div>



        <form id="dersoForm" style="display: none;">

            <div class="form-group">

                <label for="email">E-mail:</label>

                <input type="email" id="email" name="email" list="emailProviders" required autofocus>

                <datalist id="emailProviders"></datalist>

            </div>



            <div class="form-group">

                <label for="matricula">MatrÃ­cula:</label>

                <input type="text" id="matricula" name="matricula" required placeholder="Ex: 12345 ou 100012345">

                <div id="matriculaError" class="error"></div>

            </div>



            <div class="form-group">

                <label for="nome">Nome:</label>

                <input type="text" id="nome" name="nome" readonly required>

            </div>



            <fieldset>

                <legend>Tipo de Folga<span class="required-star">*</span>:</legend>

                <div class="radio-group-buttons">

                    <input type="radio" id="folga24H" name="folga" value="24H" required><label for="folga24H">24H</label>

                    <input type="radio" id="folga48H" name="folga" value="48H"><label for="folga48H">48H</label>

                    <input type="radio" id="folga72H" name="folga" value="72H"><label for="folga72H">72H</label>

                    <input type="radio" id="folga96H" name="folga" value="96H"><label for="folga96H">96H</label>

                    <input type="radio" id="folgaLE" name="folga" value="FOLGA LE"><label for="folgaLE">FOLGA LE</label>

                    <input type="radio" id="folga1" name="folga" value="1Âª Folga"><label for="folga1">1Âª FOLGA</label>

                    <input type="radio" id="folga2" name="folga" value="2Âª Folga"><label for="folga2">2Âª FOLGA</label>

                    <input type="radio" id="folgaExp" name="folga" value="Expediente"><label for="folgaExp">EXPEDIENTE</label>

                </div>

                <div id="duplicateError" class="error"></div>

            </fieldset>



            <div class="form-group">

                <label for="data">Data:</label>

                <input type="date" id="data" name="data" required>

                <div id="dateLimitMessage" class="subtitle" style="margin-top: 5px; margin-bottom: 0; font-size: 13px; text-align: left;"></div>

            </div>



            <button type="submit" class="button">Enviar SolicitaÃ§Ã£o</button>

        </form>

        

        <div id="statusMessage" class="info-message"></div>



        <div class="footer" id="footerText"></div>

    </div>



   <script>
Â  Â  Â  Â  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwe2vseE23YEgIwPxOHiXlv3COUfJYVRsMSTYov0v78zSgDZtOeTCYx1J8GOzlzKhwDFg/exec";
Â  Â  Â  Â  const emailProviders = ["gmail.com","hotmail.com","outlook.com","yahoo.com","terra.com.br","bol.com.br"];
Â  Â  Â  Â  window.employeeList = {};

Â  Â  Â  Â  const progressBar = document.getElementById("progressBar");
Â  Â  Â  Â  const formDiv = document.getElementById("dersoForm");
Â  Â  Â  Â  const initialLoadingDiv = document.getElementById("initialLoading");
Â  Â  Â  Â  const loadingOverlay = document.getElementById("loadingOverlay");
Â  Â  Â  Â  const prazoMessageDiv = document.getElementById("prazoMessage");

Â  Â  Â  Â  function setProgress(percent) {
Â  Â  Â  Â  Â  Â  progressBar.style.width = percent + "%";
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateEmailDatalist() {
Â  Â  Â  Â  Â  Â  const emailInput = document.getElementById("email");
Â  Â  Â  Â  Â  Â  const datalist = document.getElementById("emailProviders");
Â  Â  Â  Â  Â  Â  const value = emailInput.value;
Â  Â  Â  Â  Â  Â  const atIndex = value.indexOf("@");
Â  Â  Â  Â  Â  Â  if (atIndex === -1) { datalist.innerHTML = ""; return; }
Â  Â  Â  Â  Â  Â  const domainPart = value.slice(atIndex + 1).toLowerCase();
Â  Â  Â  Â  Â  Â  const filtered = emailProviders.filter(p => p.startsWith(domainPart));
Â  Â  Â  Â  Â  Â  datalist.innerHTML = "";
Â  Â  Â  Â  Â  Â  filtered.forEach(p => { const option = document.createElement("option"); option.value = value.slice(0, atIndex+1)+p; datalist.appendChild(option); });
Â  Â  Â  Â  }

Â  Â  Â  Â  function standardizeMatricula(m) {
Â  Â  Â  Â  Â  Â  let num = m.replace(/\D/g,'').slice(0,9);
Â  Â  Â  Â  Â  Â  // Padroniza para o formato 1000xxxx se o nÃºmero tiver 5 dÃ­gitos (assumindo que o ID Ã© 5 dÃ­gitos)
Â  Â  Â  Â  Â  Â  return num.length === 5 && !num.startsWith("1000") ? "1000"+num : num;
Â  Â  Â  Â  }
        
Â  Â  Â  Â  function debounce(func, delay) {
Â  Â  Â  Â  Â  Â  let timeoutId;
Â  Â  Â  Â  Â  Â  return (...args) => {
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(timeoutId);
Â  Â  Â  Â  Â  Â  Â  Â  timeoutId = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  func.apply(this, args);
Â  Â  Â  Â  Â  Â  Â  Â  }, delay);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  async function checkDuplicity(matricula, data, folga) {
Â  Â  Â  Â  Â  Â  const url = `${SCRIPT_URL}?action=check_duplicidade&matricula=${matricula}&data=${data}&folga=${folga}`;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  Â  Â  Â  const dataJson = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  return dataJson.duplicado === true;Â 
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Falha ao verificar duplicidade:", e);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("âš ï¸ Erro ao verificar duplicidade. Tentando enviar...", "error", true);Â 
Â  Â  Â  Â  Â  Â  Â  Â  return false;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
        
Â  Â  Â  Â  // ğŸ¯ FUNÃ‡ÃƒO DE CHECAGEM DA MATRÃCULA OTIMIZADA
Â  Â  Â  Â  function checkMatricula(isBlur = false) {
Â  Â  Â  Â  Â  Â  const m = document.getElementById("matricula");
Â  Â  Â  Â  Â  Â  const n = document.getElementById("nome");
Â  Â  Â  Â  Â  Â  const e = document.getElementById("matriculaError");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!m.value.trim()) {
Â  Â  Â  Â  Â  Â  Â  Â  n.value = "";
Â  Â  Â  Â  Â  Â  Â  Â  e.textContent = "";Â 
Â  Â  Â  Â  Â  Â  Â  Â  m.classList.remove("is-valid", "is-invalid");
Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Padroniza o valor do campo APENAS no evento blur (saÃ­da do campo)
Â  Â  Â  Â  Â  Â  if(isBlur) {
Â  Â  Â  Â  Â  Â  Â  Â  m.value = standardizeMatricula(m.value);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const standardizedForLookup = standardizeMatricula(m.value);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  m.classList.remove("is-valid", "is-invalid");

Â  Â  Â  Â  Â  Â  if(window.employeeList[standardizedForLookup]) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  n.value = window.employeeList[standardizedForLookup];Â 
Â  Â  Â  Â  Â  Â  Â  Â  e.textContent = "";Â 
Â  Â  Â  Â  Â  Â  Â  Â  m.classList.add("is-valid");Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  n.value = "";Â 
Â  Â  Â  Â  Â  Â  Â  Â  e.textContent = "MatrÃ­cula nÃ£o encontrada!";Â 
Â  Â  Â  Â  Â  Â  Â  Â  m.classList.add("is-invalid");Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
        
Â  Â  Â  Â  const debouncedCheckMatricula = debounce(() => checkMatricula(false), 300);

Â  Â  Â  Â  function clearNomeOnInput() {
Â  Â  Â  Â  Â  Â  const n = document.getElementById("nome");
Â  Â  Â  Â  Â  Â  n.value = "";
Â  Â  Â  Â  }

Â  Â  Â  Â  function setDateLimits() {
Â  Â  Â  Â  Â  Â  const dateInput = document.getElementById("data");
Â  Â  Â  Â  Â  Â  const messageDiv = document.getElementById("dateLimitMessage");Â 

Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  let nextMonthStart = new Date(today.getFullYear(), today.getMonth() + 1, 1);
Â  Â  Â  Â  Â  Â  let nextMonthEnd = new Date(today.getFullYear(), today.getMonth() + 2, 0);

Â  Â  Â  Â  Â  Â  dateInput.min = nextMonthStart.toISOString().split("T")[0];
Â  Â  Â  Â  Â  Â  dateInput.max = nextMonthEnd.toISOString().split("T")[0];

Â  Â  Â  Â  Â  Â  const startDay = nextMonthStart.getDate().toString().padStart(2, '0');
Â  Â  Â  Â  Â  Â  const startMonth = (nextMonthStart.getMonth() + 1).toString().padStart(2, '0');
Â  Â  Â  Â  Â  Â  const endDay = nextMonthEnd.getDate().toString().padStart(2, '0');
Â  Â  Â  Â  Â  Â  const endMonth = (nextMonthEnd.getMonth() + 1).toString().padStart(2, '0');

Â  Â  Â  Â  Â  Â  messageDiv.textContent = `PerÃ­odo de folga permitido: ${startDay}/${startMonth} a ${endDay}/${endMonth}.`;
Â  Â  Â  Â  }

Â  Â  Â  Â  function formatDateBR(d) {
Â  Â  Â  Â  Â  Â  if(!d) return "";
Â  Â  Â  Â  Â  Â  const [y,m,day] = d.split("-");
Â  Â  Â  Â  Â  Â  return `${day}/${m}/${y}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  async function submitForm(e){
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const form = document.getElementById("dersoForm");
Â  Â  Â  Â  Â  Â  const btn = document.querySelector(".button");
Â  Â  Â  Â  Â  Â  const matriculaInput = document.getElementById("matricula");
Â  Â  Â  Â  Â  Â  const dataValue = document.getElementById("data").value;
Â  Â  Â  Â  Â  Â  const folgaRadio = document.querySelector('input[name="folga"]:checked');
Â  Â  Â  Â  Â  Â  const duplicateError = document.getElementById("duplicateError");
Â  Â  Â  Â  Â  Â  const nomeValue = document.getElementById("nome").value.trim();
Â  Â  Â  Â  Â  Â  const dataBR = formatDateBR(dataValue);

Â  Â  Â  Â  Â  Â  duplicateError.textContent = "";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ValidaÃ§Ãµes bÃ¡sicas
Â  Â  Â  Â  Â  Â  if(!folgaRadio){
Â  Â  Â  Â  Â  Â  Â  Â  duplicateError.textContent = "Selecione um Tipo de Folga.";Â 
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(nomeValue === "" || matriculaInput.classList.contains("is-invalid")){
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("matriculaError").textContent = nomeValue === "" ? "MatrÃ­cula invÃ¡lida. Verifique o nÃºmero." : "MatrÃ­cula invÃ¡lida.";Â 
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  Â  Â  loadingOverlay.style.display = "flex";
Â  Â  Â  Â  Â  Â  setProgress(60);

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // 1. VERIFICAÃ‡ÃƒO DE DUPLICIDADE
Â  Â  Â  Â  Â  Â  Â  Â  const isDuplicate = await checkDuplicity(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  matriculaInput.value,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dataBR,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  folgaRadio.value
Â  Â  Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  Â  Â  if (isDuplicate) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`âš ï¸ SolicitaÃ§Ã£o DUPLICADA. VocÃª jÃ¡ solicitou **${folgaRadio.value}** para ${dataBR}.`, "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 2. ENVIO FINAL
Â  Â  Â  Â  Â  Â  Â  Â  const fd = new FormData(form);
Â  Â  Â  Â  Â  Â  Â  Â  fd.set("data", dataBR);
Â  Â  Â  Â  Â  Â  Â  Â  fd.set("folga", folgaRadio.value);Â 

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(SCRIPT_URL, {method: "POST", body: new URLSearchParams(fd)});
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  if(data.success){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("âœ… SolicitaÃ§Ã£o enviada com sucesso! Um resumo foi enviado para o seu e-mail.","success");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.reset();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("nome").value = "";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("matricula").classList.remove("is-valid", "is-invalid");
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("âš ï¸ "+(data.error||"Erro ao enviar. Tente novamente."),"error");
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch(error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro na duplicidade ou envio:", error);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage("âš ï¸ Falha na conexÃ£o ou processamento. Tente novamente.", "error");
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  loadingOverlay.style.display = "none";
Â  Â  Â  Â  Â  Â  Â  Â  setProgress(100);
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(()=>setProgress(0), 1500);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function showMessage(msg, type = "success") {
Â  Â  Â  Â  Â  Â  const div = document.getElementById("statusMessage");
Â  Â  Â  Â  Â  Â  div.className = "info-message " + type;
Â  Â  Â  Â  Â  Â  div.innerHTML = msg;Â 
Â  Â  Â  Â  Â  Â  div.style.display = "block";
Â  Â  Â  Â  Â  Â  setTimeout(() => { div.style.display = "none"; }, 5000);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function showPersistentMessage(msg, type = "success") {
Â  Â  Â  Â  Â  Â  prazoMessageDiv.className = "info-message " + type;
Â  Â  Â  Â  Â  Â  prazoMessageDiv.innerHTML = msg;
Â  Â  Â  Â  Â  Â  prazoMessageDiv.style.display = "block";
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  // ğŸ¯ FUNÃ‡ÃƒO DE INICIALIZAÃ‡ÃƒO OTIMIZADA COM PROMISE.ALL
Â  Â  Â  Â  async function initializeForm(){
Â  Â  Â  Â  Â  Â  setDateLimits();
Â  Â  Â  Â  Â  Â  const footer = document.getElementById("footerText");Â 
Â  Â  Â  Â  Â  Â  const matriculaInput = document.getElementById("matricula");

Â  Â  Â  Â  Â  Â  // Prepara o campo de matrÃ­cula para o carregamento
Â  Â  Â  Â  Â  Â  matriculaInput.disabled = true;Â 
Â  Â  Â  Â  Â  Â  matriculaInput.placeholder = "Carregando lista de funcionÃ¡rios...";
            setProgress(10);
            
Â  Â  Â  Â  Â  Â  try {
                // Carrega dados de funcionÃ¡rios e datas de prazo SIMULTANEAMENTE
Â  Â  Â  Â  Â  Â  Â  Â  const [employeeResponse, datesResponse] = await Promise.all([
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetch(SCRIPT_URL + "?action=lista"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetch(SCRIPT_URL + "?action=datas")
Â  Â  Â  Â  Â  Â  Â  Â  ]);

Â  Â  Â  Â  Â  Â  Â  Â  const employeeData = await employeeResponse.json();
Â  Â  Â  Â  Â  Â  Â  Â  const dateData = await datesResponse.json();
                
                setProgress(40);
                
                // Trata dados de funcionÃ¡rios
Â  Â  Â  Â  Â  Â  Â  Â  if (employeeData.error) throw new Error(employeeData.error);
Â  Â  Â  Â  Â  Â  Â  Â  window.employeeList = employeeData;
Â  Â  Â  Â  Â  Â  Â  Â  matriculaInput.disabled = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  matriculaInput.placeholder = "Ex: 12345 ou 100012345";
                
                // Trata dados de prazo
Â  Â  Â  Â  Â  Â  Â  Â  if (dateData.error) throw new Error(dateData.error);
                
Â  Â  Â  Â  Â  Â  Â  Â  const agora = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  const abertura = new Date(dateData.abertura);
Â  Â  Â  Â  Â  Â  Â  Â  const fechamento = new Date(dateData.fechamento);

Â  Â  Â  Â  Â  Â  Â  Â  initialLoadingDiv.style.display = "none";
                
Â  Â  Â  Â  Â  Â  Â  Â  if(agora < abertura || agora > fechamento){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // PerÃ­odo Fechado
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const msg = agora < abertura
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `â³ **Abertura:** ${abertura.toLocaleString("pt-BR")}`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `â›” **Encerrado:** ${fechamento.toLocaleString("pt-BR")}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showPersistentMessage(msg, "error");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formDiv.style.display = "none";Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // PerÃ­odo Aberto
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formDiv.style.display = "block";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const diffTime = fechamento.getTime() - agora.getTime();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Calcula em dias, arredondando para cima
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const msg = `ğŸš¨ **AtenÃ§Ã£o!** Restam **${diffDays} dia(s)** para o fechamento em ${fechamento.toLocaleDateString("pt-BR")} Ã s ${fechamento.toLocaleTimeString("pt-BR")}.`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showPersistentMessage(msg, "success");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro na inicializaÃ§Ã£o:", error);
Â  Â  Â  Â  Â  Â  Â  Â  showPersistentMessage(`âš ï¸ Falha grave: ${error.message}. Verifique a conexÃ£o do script.`, "error");
Â  Â  Â  Â  Â  Â  Â  Â  initialLoadingDiv.style.display = "none";
Â  Â  Â  Â  Â  Â  Â  Â  formDiv.style.display = "none";
Â  Â  Â  Â  Â  Â  }
            
            // Texto do rodapÃ©
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  const mes = now.getMonth()+1; const ano = now.getFullYear();
Â  Â  Â  Â  Â  Â  footer.textContent=`Desenvolvido na 1Âª Cia do 1Âº BPM pelo PVSA Pedro Porto - ${mes.toString().padStart(2,'0')}/${ano}`;
Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  document.addEventListener("DOMContentLoaded",()=>{
Â  Â  Â  Â  Â  Â  initializeForm();
            // ğŸ¯ Eventos atualizados para melhor UX:
Â  Â  Â  Â  Â  Â  document.getElementById("matricula").addEventListener("input", clearNomeOnInput); // Limpa nome imediatamente
            // ğŸ¯ Debounced checkMatricula no input, checkMatricula(true) no blur para padronizar
Â  Â  Â  Â  Â  Â  document.getElementById("matricula").addEventListener("input", debouncedCheckMatricula);
            document.getElementById("matricula").addEventListener("blur", () => checkMatricula(true));
            
Â  Â  Â  Â  Â  Â  document.getElementById("email").addEventListener("input",updateEmailDatalist);
Â  Â  Â  Â  Â  Â  document.getElementById("dersoForm").addEventListener("submit",submitForm);
Â  Â  Â  Â  });
Â  Â  </script>

</body>

</html>
